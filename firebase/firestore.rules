rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{uid} {
    	allow read, write: if request.auth != null && request.auth.uid == uid;
    }


    // Customers: admin read-only from client; writes go via Admin SDK
    match /customers/{customerId} {
    	allow read, write: if true;
    }
    
    
    // Orders: top-level collection

    // Helper function to check if user is admin
    function isAdmin() {
      return request.auth != null && (
        request.auth.token.admin == true ||
        request.auth.token.email.matches('.*@yourdomain\\.com$') // Add your domain
        // Or check specific emails (less flexible)
        ||
        request.auth.token.email == 'conposo@gmail.com'
      );
    }

    // Orders: top-level collection
    match /orders/{orderId} {
      // For collection queries, allow if admin
      allow read: if isAdmin();
      
      // For individual document reads, also allow if user owns the order
      allow get: if request.auth != null && (
        request.auth.uid == resource.data.userId || 
        isAdmin()
      );
      
      allow create: if request.auth != null && (
        request.auth.uid == request.resource.data.userId || 
        isAdmin()
      );
      allow update: if isAdmin();
      allow delete: if isAdmin();
    }
    
    // Products and Categories
    match /products/{productId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /categories/{categoryId} {
      allow read: if true;
      allow write: if isAdmin();
    }
  }
}


